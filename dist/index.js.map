{"version":3,"sources":["../src/index.js"],"names":["http","fs","qs","contacts","port","app","listen","console","log","use","req","res","next","method","url","static","urlencoded","extended","get","send","post","obj","body","JSON","stringify","contact","err","status","load","then","addContact","save","write","name","end","catch"],"mappings":";;AAAA;;IAAYA,I;;AACZ;;IAAYC,E;;AAGZ;;IAAYC,E;;AACZ;;;;AACA;;;;AAEA;;;;;;AANA;AACA;AAOA,IAAIC,WAAW,6BAAgB,qBAAhB,CAAf;AACA,IAAMC,OAAO,IAAb;;AAEA,IAAMC,MAAM,wBAAZ;AACAA,IAAIC,MAAJ,CAAWF,IAAX,EAAiB,YAAM;AACtBG,SAAQC,GAAR,6BAAuCJ,IAAvC;AACA,CAFD;;AAIAC,IAAII,GAAJ,CAAQ,UAACC,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC3BL,SAAQC,GAAR,CAAYE,IAAIG,MAAhB,EAAwBH,IAAII,GAA5B;AACAF;AACA,CAHD;;AAKAP,IAAII,GAAJ,CAAQ,SAAR,EAAmB,kBAAQM,MAAR,CAAe,QAAf,CAAnB;AACAV,IAAII,GAAJ,CAAQ,qBAAWO,UAAX,CAAsB,EAAEC,UAAU,IAAZ,EAAtB,CAAR;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEAZ,IAAIa,GAAJ,CAAQ,GAAR,EAAa,UAACR,GAAD,EAAMC,GAAN,EAAc;AAC1B;AACAA,KAAIQ,IAAJ,CAAS,8BAAT;AACA,CAHD;;AAKAd,IAAIe,IAAJ,CAAS,cAAT,EAAyB,UAACV,GAAD,EAAMC,GAAN,EAAc;AACtC;AACA,KAAMU,MAAMX,IAAIY,IAAhB;AACAf,SAAQC,GAAR,qBAA+Be,KAAKC,SAAL,CAAeH,GAAf,CAA/B;;AAEA,KAAII,gBAAJ;AACA,KAAG;AACFA,YAAU,yBAAYJ,GAAZ,CAAV;AACA,EAFD,CAGA,OAAMK,GAAN,EAAU;AACT,SAAOf,IAAIgB,MAAJ,CAAW,GAAX,EAAgBR,IAAhB,CAAqBO,GAArB,CAAP;AACA;;AAED,QAAOvB,SAASyB,IAAT,GACNC,IADM,CACD,YAAM;AACX1B,WAAS2B,UAAT,CAAoBL,OAApB;AACAtB,WAAS4B,IAAT;AACA,EAJM,EAKNF,IALM,CAKD,YAAM;AACXlB,MAAIqB,KAAJ,kCAA0CP,QAAQQ,IAAlD;AACAtB,MAAIuB,GAAJ;AACA,EARM,EASNC,KATM,CASA,UAACT,GAAD,EAAS;AACff,MAAIgB,MAAJ,CAAW,GAAX,EAAgBR,IAAhB,CAAqBO,GAArB;AACA,EAXM,CAAP;AAYA,CAzBD;;AA2BArB,IAAIa,GAAJ,CAAQ,eAAR,EAAyB,UAACR,GAAD,EAAMC,GAAN,EAAc;AACtC,QAAOR,SAASyB,IAAT,GACNC,IADM,CACD,YAAM;AACXlB,MAAIQ,IAAJ,CAASI,KAAKC,SAAL,CAAerB,SAAS,MAAT,CAAf,CAAT;AACA,EAHM,CAAP;AAIA,CALD;;AAQA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.js","sourcesContent":["import * as http from \"http\";\r\nimport * as fs from \"fs\";\r\n// querystring is used to parse url parameters to an object\r\n// also a core module\r\nimport * as qs from \"querystring\";\r\nimport express from \"express\";\r\nimport bodyParser from \"body-parser\";\r\n\r\nimport { Contact, ContactList } from\"./ContactList.js\";\r\n\r\nlet contacts = new ContactList(\"./src/contacts.json\");\r\nconst port = 8080;\r\n\r\nconst app = express();\r\napp.listen(port, () => {\r\n\tconsole.log(`Server started at port ${ port }`);\r\n});\r\n\r\napp.use((req, res, next) => {\r\n\tconsole.log(req.method, req.url);\r\n\tnext();\r\n});\r\n\r\napp.use(\"/public\", express.static('public'));\r\napp.use(bodyParser.urlencoded({ extended: true }));\r\n\r\n// app.use((req, res, next) => {\r\n// \tconsole.log(\"Second middleware\");\r\n// \tif(req.url === \"/\")\r\n// \t\tconsole.log(\"Index request\");\r\n// \tnext();\r\n// });\r\n\r\napp.get(\"/\", (req, res) => {\r\n\t// console.log(\"get 1\");\r\n\tres.send(\"This is the webserver index.\");\r\n});\r\n\r\napp.post(\"/add-contact\", (req, res) => {\r\n\t// console.log(\"post 2\");\r\n\tconst obj = req.body;\r\n\tconsole.log(`Incoming user: ${ JSON.stringify(obj) }`);\r\n\r\n\tlet contact;\r\n\ttry{\r\n\t\tcontact = new Contact(obj);\r\n\t}\r\n\tcatch(err){\r\n\t\treturn res.status(401).send(err);\r\n\t}\r\n\r\n\treturn contacts.load()\r\n\t.then(() => {\r\n\t\tcontacts.addContact(contact);\r\n\t\tcontacts.save();\r\n\t})\r\n\t.then(() => {\r\n\t\tres.write(`Successfully saved contact: ${ contact.name }`);\r\n\t\tres.end();\r\n\t})\r\n\t.catch((err) => {\r\n\t\tres.status(500).send(err);\r\n\t})\r\n});\r\n\r\napp.get(\"/all-contacts\", (req, res) => {\r\n\treturn contacts.load()\r\n\t.then(() => {\r\n\t\tres.send(JSON.stringify(contacts[\"list\"]));\r\n\t});\r\n});\r\n\r\n\r\n// http\r\n// .createServer((req, res) => {\r\n// \t// log the incoming request\r\n// \tconsole.log(req.method, req.url);\r\n\r\n// \tif(req.url === '/'){\r\n// \t\tres.write(\"This is the webserver index.\")\r\n// \t\treturn res.end();\r\n// \t}\r\n\r\n// \tif(req.url === '/add-contact' && req.method === 'POST'){\r\n// \t\tlet body = \"\";\r\n// \t\treq.on(\"data\", chunk => {\r\n// \t        body += chunk;\r\n// \t    });\r\n\r\n// \t    req.on(\"end\", () => {\r\n// \t    \tconsole.log(\"Received params:\", qs.parse(body));\r\n// \t    \tconst obj = qs.parse(body);\r\n\r\n// \t    \tlet contact;\r\n// \t    \ttry{\r\n// \t\t\t\tcontact = new Contact(obj);\r\n// \t    \t}\r\n// \t    \tcatch(err){\r\n// \t    \t\tconsole.log(err);\r\n// \t    \t\tres.statusCode = 401;\r\n// \t    \t\tres.write(err);\r\n// \t    \t\treturn res.end();\r\n// \t    \t}\r\n\r\n// \t\t\treturn contacts.load()\r\n// \t\t\t.then(() => {\r\n// \t\t\t\tcontacts.addContact(contact);\r\n// \t\t\t\tcontacts.save();\r\n// \t\t\t})\r\n// \t\t\t.then(() => {\r\n// \t\t\t\tres.write(`Successfully saved contact: ${ contact.name }`);\r\n// \t\t\t\tres.end();\r\n// \t\t\t})\r\n// \t\t\t.catch((err) => {\r\n// \t\t\t\tconsole.log(\"Error saving contact:\", err);\r\n// \t\t\t\tres.statusCode = 500;\r\n// \t\t\t\tres.write(\"Error saving contact.\");\r\n// \t\t\t\tres.end();\r\n// \t\t\t})\r\n// \t    });\r\n// \t} \r\n// \telse if(req.url === '/all-contacts'){\r\n// \t\treturn contacts.load()\r\n// \t\t.then(()=> {\r\n// \t\t\tconsole.log(contacts);\r\n// \t\t\t// console.log(contacts[\"list\"]);\r\n\r\n// \t\t\tres.write(JSON.stringify(contacts.list));\r\n\t\t\t\r\n// \t\t\tres.end();\r\n// \t\t})\r\n// \t\t.catch(err => {\r\n// \t\t\tconsole.log(err);\r\n// \t\t\tres.statusCode = 500;\r\n// \t\t\tres.write(\"Internal server error\");\r\n// \t\t\tres.end();\r\n// \t\t});\r\n// \t}\r\n// \telse\r\n// \t// if none the urls above match, search for file in public folder\r\n// \t\tfs.readFile(`./public${ req.url }`, \"utf8\", (err, data) => {\r\n// \t\t\tif(err){\r\n// \t\t\t\tconsole.log(\"Error reading file:\", err);\r\n// \t\t\t\tres.statusCode = 404;\r\n// \t\t\t\tres.write(\"File not found.\");\r\n// \t\t\t\treturn res.end();\r\n// \t\t\t}\r\n// \t\t\t// console.log(\"Data:\", data);\r\n// \t\t\tres.write(data);\r\n// \t\t\tres.end();\r\n// \t\t});\r\n// })\r\n// .listen(8080);"]}